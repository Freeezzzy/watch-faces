<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Ferrofluid Watchface</title>
<style>
  body {
    margin: 0;
    background-color: black;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    overflow: hidden;
  }
  canvas {
    display: block;
  }
</style>
</head>
<body>
<script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.0/p5.min.js"></script>
<script>
let baseRadius = 90;
let blobDetail = 60;
let pulse = 0;
let lastSecond = -1;
let hours = 0;
let minutes = 0;
let time = 0;
let pos, vel;

function setup() {
  createCanvas(400, 400);
  angleMode(RADIANS);
  frameRate(60);
  updateTime();
  noiseDetail(3, 0.6);
  pos = createVector(width / 2, height / 2);
  vel = createVector(random(-0.3, 0.3), random(-0.3, 0.3));
}

function draw() {
  background(0);
  moveBlob();

  let currentSecond = second();
  if (currentSecond !== lastSecond) {
    pulse = 1;
    updateTime();
    lastSecond = currentSecond;
  }

  push();
  translate(pos.x, pos.y);
  drawFerroBlob();
  drawHourZacken();
  drawMinuteZacken();
  pop();

  pulse *= 0.9;
  time += 0.01;
}

function moveBlob() {
  pos.add(vel);
  if (pos.x < 80 || pos.x > width - 80) vel.x *= -1;
  if (pos.y < 80 || pos.y > height - 80) vel.y *= -1;
}

function updateTime() {
  let h = hour();
  let m = minute();
  hours = h % 12;
  minutes = m;
}

function drawFerroBlob() {
  noFill();
  stroke(255, 0, 0);
  strokeWeight(1.5);
  beginShape();
  for (let i = 0; i < TWO_PI; i += TWO_PI / blobDetail) {
    let freq = 20; // ferrofluid spike frequency
    let amp = 15;  // spike amplitude
    let r = baseRadius + sin(i * freq + time * 3) * amp + noise(cos(i) * 2, sin(i) * 2, time) * 20 + pulse * 10;
    let x = cos(i) * r;
    let y = sin(i) * r;
    curveVertex(x, y);
  }
  endShape(CLOSE);
}

function drawHourZacken() {
  push();
  stroke(255);
  strokeWeight(2);
  let spikeLength = 18;
  for (let i = 0; i < hours; i++) {
    let angle = map(i, 0, 12, -PI / 2, PI * 3 / 2);
    let x1 = cos(angle) * (baseRadius + 40);
    let y1 = sin(angle) * (baseRadius + 40);
    let x2 = cos(angle) * (baseRadius + 40 + spikeLength);
    let y2 = sin(angle) * (baseRadius + 40 + spikeLength);
    line(x1, y1, x2, y2);
  }
  pop();
}

function drawMinuteZacken() {
  push();
  stroke(180);
  strokeWeight(1);
  let count = minutes;
  let offsetY = baseRadius + 90;
  translate(0, offsetY);
  for (let i = 0; i < count; i++) {
    let x = map(i, 0, 60, -160, 160);
    let height = 10;
    if (i % 10 === 0) height = 30;
    else if (i % 5 === 0) height = 20;
    line(x, 0, x, -height);
  }
  pop();
}
</script>
</body>
</html>
