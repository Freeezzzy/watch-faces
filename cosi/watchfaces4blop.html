<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Ferrofluid Watchface</title>
<style>
  body {
    margin: 0;
    background-color: black;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    overflow: hidden;
  }
  canvas {
    display: block;
  }
</style>
</head>
<body>
<script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.0/p5.min.js"></script>
<script>
let baseRadius = 90;
let blobDetail = 180;
let pulse = 0;
let lastSecond = -1;
let hours = 0;
let minutes = 0;
let time = 0;
let blob;

function setup() {
  createCanvas(400, 400);
  angleMode(RADIANS);
  frameRate(60);
  updateTime();
  noiseDetail(3, 0.6);
  blob = createBlob(width / 2, height / 2);
}

function draw() {
  background(0);

  drawDisplayBorder();
  drawHourZacken();
  drawMinuteZacken();

  let currentSecond = second();
  if (currentSecond !== lastSecond) {
    pulse = 1;
    updateTime();
    lastSecond = currentSecond;
  }

  blob.update();
  blob.draw();

  pulse *= 0.9;
  time += 0.01;
}

function updateTime() {
  let h = hour();
  let m = minute();
  hours = h % 12;
  minutes = m;
}

function drawDisplayBorder() {
  noFill();
  stroke(255);
  strokeWeight(2);
  rectMode(CENTER);
  rect(width / 2, height / 2, 360, 360, 40);
}

function createBlob(x, y) {
  return {
    pos: createVector(x, y),
    vel: p5.Vector.random2D().mult(1.0),
    update() {
      this.pos.add(this.vel);
      if (this.pos.x < 80 || this.pos.x > width - 80) this.vel.x *= -1;
      if (this.pos.y < 80 || this.pos.y > height - 80) this.vel.y *= -1;
    },
    draw() {
      push();
      translate(this.pos.x, this.pos.y);
      this.drawFerroBlob();
      pop();
    },
    drawFerroBlob() {
      noFill();
      stroke(255, 0, 0);
      strokeWeight(1.5);
      beginShape();
      for (let i = 0; i < TWO_PI; i += TWO_PI / blobDetail) {
        let freq = 10;
        let amp = 30;
        let r = baseRadius + sin(i * freq + time) * amp + noise(cos(i) * 2, sin(i) * 2, time) * 35 + pulse * 20;
        let x = cos(i) * r;
        let y = sin(i) * r;
        curveVertex(x, y);
      }
      endShape(CLOSE);
    }
  }
}

function drawHourZacken() {
  push();
  stroke(255);
  strokeWeight(2);
  let radius = 180;
  let spikeLength = 18;
  for (let i = 0; i < hours; i++) {
    let angle = map(i, 0, 12, -PI / 2, PI * 3 / 2);
    let x1 = width / 2 + cos(angle) * radius;
    let y1 = height / 2 + sin(angle) * radius;
    let x2 = width / 2 + cos(angle) * (radius + spikeLength);
    let y2 = height / 2 + sin(angle) * (radius + spikeLength);
    line(x1, y1, x2, y2);
  }
  pop();
}

function drawMinuteZacken() {
  push();
  stroke(180);
  strokeWeight(1);
  let radius = 180;
  for (let i = 0; i < minutes; i++) {
    let angle = map(i, 0, 60, PI, TWO_PI);
    let length = 10;
    if (i % 10 === 0) length = 30;
    else if (i % 5 === 0) length = 20;
    let x1 = width / 2 + cos(angle) * radius;
    let y1 = height / 2 + sin(angle) * radius;
    let x2 = width / 2 + cos(angle) * (radius + length);
    let y2 = height / 2 + sin(angle) * (radius + length);
    line(x1, y1, x2, y2);
  }
  pop();
}
</script>
</body>
</html>